<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stunning Wealth Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="styles.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js" defer></script>
<script src="./config.sample.js" defer></script>
<script src="./config.local.js" defer></script>
<script src="./app.js" defer></script>
</head>
<body>
<button id="theme-toggle" class="theme-toggle" aria-label="Switch to light mode">
    <span class="theme-icon">&#9728;</span>
    <span class="sr-only">Toggle theme</span>
</button>

<div id="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text">Loading portfolio&hellip;</div>
</div>

<div class="wrap">
    <header>
        <div>
            <div class="pill">Realtime Wealth Overview &middot; <span>Connected</span></div>
            <h1>Wealth Intelligence Hub</h1>
            <p class="subtitle">Live holdings pulled directly from Airtable Operations and enriched with Finnhub market data. Track allocations, intraday moves, and long-term performance in one glass dashboard.</p>
        </div>
    </header>

    <div class="top-summary">
        <div class="kpi" id="pnl-card">
            <div style="flex:1">
                <div class="pnl-label-row">
                    <div class="label">Total P&amp;L</div>
                    <div id="pnl-range-controls" class="pnl-range-controls">
                        <button data-range="1D" class="active">1D</button>
                        <button data-range="1W">1W</button>
                        <button data-range="1M">1M</button>
                        <button data-range="1Y">1Y</button>
                        <button data-range="ALL">All</button>
                    </div>
                </div>
                <div class="big" id="total-pnl">$0.00</div>
                <small>Updated: <span id="last-updated">&mdash;</span> &middot; <span id="pnl-range-label">Daily</span></small>
            </div>
            <div style="width:220px;height:95px">
                <canvas id="sparkline" aria-label="pnl sparkline"></canvas>
            </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:14px">
            <div class="kpi" style="min-height:120px">
                <div style="flex:1">
                    <div class="label">Net Worth</div>
                    <div class="big" id="equity">$0.00</div>
                    <small>Net contributions deployed to date</small>
                </div>
            </div>
            <div class="kpi" style="min-height:120px">
                <div style="flex:1">
                    <div class="label">Liquidity</div>
                    <div class="big" id="buying-power">$0.00</div>
                    <small>Cash &amp; cash-equivalents from Operations</small>
                </div>
            </div>
            <div class="kpi best-performer-card" id="best-performer-card">
                <div class="best-performer-header">
                    <div class="label">Best Performer</div>
                    <div class="best-performer-range" id="best-performer-range">Daily</div>
                </div>
                <div class="best-performer-name" id="best-performer-name">&mdash;</div>
                <div class="best-performer-metrics">
                    <span class="best-performer-pnl" id="best-performer-pnl">$0.00</span>
                    <span class="best-performer-change" id="best-performer-change">&mdash;</span>
                </div>
                <small class="best-performer-meta" id="best-performer-meta">Awaiting data&hellip;</small>
            </div>
        </div>
    </div>

    <div class="grid">
        <div class="card full">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;position:relative;z-index:1">
                <div>
                    <strong>Profit &amp; Loss by Asset</strong>
                    <div class="pos" style="margin-top:4px">Sortable insight powered by Finnhub live prices and Airtable operations</div>
                </div>
                <div style="display:flex;gap:10px">
                    <button class="btn" id="sort-pnl">Sort: High &rarr; Low</button>
                    <button class="btn" id="export-csv">Export CSV</button>
                </div>
            </div>
            <div style="flex:1;margin-top:12px;min-height:320px;position:relative;z-index:1">
                <canvas id="pnlChart"></canvas>
            </div>
        </div>

        <div class="card">
            <strong>Portfolio Composition</strong>
            <div class="pos" style="margin-top:4px">Market value weighting across holdings</div>
            <div style="flex:1;min-height:220px;margin-top:10px">
                <canvas id="compositionChart"></canvas>
            </div>
        </div>

        <div class="card">
            <strong>Intraday Performance</strong>
            <div class="pos" style="margin-top:4px">Day-over-day moves using previous close data</div>
            <div style="flex:1;min-height:220px;margin-top:10px">
                <canvas id="dailyChangeChart"></canvas>
            </div>
        </div>

        <div class="card">
            <strong>Assets List (Live)</strong>
            <div class="pos" style="margin-top:4px">Pulled from Airtable Operations &middot; aggregated positions</div>
            <div class="list" id="assets-list"></div>
        </div>

        <div class="card">
            <strong>Allocation by Category</strong>
            <div class="pos" style="margin-top:4px">Grouped by Airtable category tags</div>
            <div style="flex:1;min-height:200px;margin-top:10px">
                <canvas id="typeAllocationChart"></canvas>
            </div>
        </div>

        <div class="card">
            <strong>Notes</strong>
            <div class="pos" style="margin-top:6px;line-height:1.6">
                Data refreshes automatically from Airtable every load and tracks real-time quote streams via the Finnhub WebSocket. Use the range toggles to pivot analytics when historical layers are added.
            </div>
        </div>

        <div class="card full asset-dynamic-card">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;position:relative;z-index:1">
                <div>
                    <strong>Asset Growth Over Years</strong>
                    <div class="pos" style="margin-top:4px">Cumulative capital deployed per asset, aggregated by calendar year.</div>
                </div>
            </div>
            <div style="flex:1;min-height:340px;margin-top:12px;position:relative;z-index:1">
                <canvas id="assetDynamicChart"></canvas>
            </div>
        </div>
    </div>

    <footer>
        <div><span class="status-dot"></span><span id="status">&nbsp;</span></div>
        <div>Powered by Airtable &middot; Finnhub &middot; Chart.js</div>
    </footer>
</div>
</body>
</html>
